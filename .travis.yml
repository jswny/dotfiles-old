os: linux

language: shell

services:
  - docker

env:
  global:
    - DOCKER_IMAGE_NAME: "jswny/dotfiles"
    - HADOLINT_VERSION: "1.17.5"
    - DIVE_VERSION: "0.9.2"
    - HADOLINT: "${HOME}/hadolint"
    - DIVE: "${HOME}/dive"
    - CI: "true"

install:
  - curl -sLo ${HADOLINT} "https://github.com/hadolint/hadolint/releases/download/v${HADOLINT_VERSION}/hadolint-$(uname -s)-$(uname -m)" && chmod 700 ${HADOLINT}
  - curl -sL "https://github.com/wagoodman/dive/releases/download/v${DIVE_VERSION}/dive_${DIVE_VERSION}_linux_amd64.tar.gz" | tar zx --directory ${HOME} && chmod 700 ${DIVE}
script:
  - shellcheck scripts/*
  - ${HADOLINT} Dockerfile
  - docker build -t jswny/dotfiles . && ${DIVE} jswny/dotfiles

deploy:
  - provider: script
    script: echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin && docker push "$DOCKER_IMAGE_NAME"
    on:
      branch: master

notifications:
  slack:
    secure: "tV+NXK3z2z3jSc8BcXT+0P11kDK8IWhn8c7h5tkTcd+X15u+oq9FHKhMNY6CLiC9MgMXbYUczc5ZlN/UG+eJVpJ8URnLnbSqOi4JIGvoH4iRudhj3HF+oWEkec86iro3s49L22L84q/3ca2NRBUiFNvl+KZK6iHAbZNaLlm6bFSvjHgDjXaZ4syGxfNoKYTM3bDD+qIppMklx3CSRRlOf5tLXS+3sMXRDQecNIcXmQITp/cp8KneG4mIP2OpqHNgV5/SLMGClXAPViX+R9x4i0hqDTwAGOwih2hZiTAQnzD2ublZPEPXSs4c8CYOhWgcRF4X4y5idUpvWhuL3/aWz5CgDs65xyrabXcVY+vn4uJqzkd8L5fYzs6NTQ58msBKZC1ZRpIyTIV7gSmc+6OjzbqlgP6hhYV1nbYaNzMYvh+dXa20OWQM/v512X1uLVUNis+puoLnq7/ohPoRScxse+QcAKDxbiC16sspNDZm803v4IpsOOW9gAUxigA+MjViP+Yl9+gwaRRtFUPZwibLioa3ybxYbsWWIK3etqxEl83E/6W1dEe89exeYWcb/KWPF024KFwA3tRCcR+txa0X7lzrio4fVI3G1yivY2LjjaIY83bJnJ6r4qz3CMl88gQFQHSEZnUHW8/PxXJDuJZoMCloCkogwsQaN5F5itXXzSw="
  email: false
