os: linux

language: shell

services:
  - docker

env:
  global:
    - DOCKER_IMAGE_NAME: "jswny/dotfiles"
    - HADOLINT_VERSION: "1.17.5"
    - DIVE_VERSION: "0.9.2"
    - HADOLINT: "${HOME}/hadolint"
    - DIVE: "${HOME}/dive"
    - CI: "true"

install:
  - curl -sLo ${HADOLINT} "https://github.com/hadolint/hadolint/releases/download/v${HADOLINT_VERSION}/hadolint-$(uname -s)-$(uname -m)" && chmod 700 ${HADOLINT}
  - curl -sL "https://github.com/wagoodman/dive/releases/download/v${DIVE_VERSION}/dive_${DIVE_VERSION}_linux_amd64.tar.gz" | tar zx --directory ${HOME} && chmod 700 ${DIVE}
script:
  - shellcheck scripts/*
  - ${HADOLINT} Dockerfile
  - docker build -t jswny/dotfiles . && ${DIVE} jswny/dotfiles

deploy:
  - provider: script
    script: echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin && docker push "$DOCKER_IMAGE_NAME"
    on:
      branch: master

notifications:
  slack:
    secure: "qjM29TQ1SNe3LqKZKIT7rPmD+iX9rS07ynRrPtiSfZ2avS3R8mgoDsDz0EUHy4l1GwMjt5VAKDDAs//rQxYbPiezvI/hwjfgjt1hU+fzkw6MercqHRJCvinxdnTp9pImwhcFmUd+2K+jHw93KLNJKRu1ZLI0En4f26nLD7HO2PKKu1BUbPiz8VOJf5bRoHj595lBGE1xfPK02r3T/u1zFlA0hh1YGidTVGkKOjo9gloUZNEloYyRvHnzQEYg1QPN2OPbQUqxhHxkV2/mW/Qm8D0nqgT+0z6+EJGSoBK6i1cmijdklTiNyExnlgtFq0S2LzbhVReHZbnBVdm6AgpK1O8RncBn3EydB1YY5uybjtH4lK48MjyMYQNwciic4TM5XexKV4CatMgF0Lg5kxZc+nhVrK9ODy2wqIn/U17u4ri0bUC0SjQfUT+7Wei3sPKL7O6wj4/dkL8mKfUEJ2LIuTHBYHJxoDTLClQXSYYtJLFuHsKYKpR8ai00zpIo/UmZ76yp/wGaPgm7GO1CcGDAMsQ5piKgg5n9m+W7EL98M0ynOYMcp1wItINVPpzP/TO72azuCsf1fGpb0RJeXeXBfeJ1Np79vTnCSrhiYlH8SIwu06vh/0ymIjI2mBzoKo/LDvKQIl0ys0CTE7gEZiPf/3fZ8G/0M7SRxDngI9jdJOI="
  email: false
