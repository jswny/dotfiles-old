os: linux

language: shell

services:
  - docker

env:
  global:
    - DOCKER_IMAGE_NAME: "jswny/dotfiles"
    - HADOLINT_VERSION: "1.17.5"
    - DIVE_VERSION: "0.9.2"
    - HADOLINT: "${HOME}/hadolint"
    - DIVE: "${HOME}/dive"
    - CI: "true"

install:
  - curl -sLo ${HADOLINT} "https://github.com/hadolint/hadolint/releases/download/v${HADOLINT_VERSION}/hadolint-$(uname -s)-$(uname -m)" && chmod 700 ${HADOLINT}
  - curl -sL "https://github.com/wagoodman/dive/releases/download/v${DIVE_VERSION}/dive_${DIVE_VERSION}_linux_amd64.tar.gz" | tar zx --directory ${HOME} && chmod 700 ${DIVE}
script:
  - shellcheck scripts/*
  - ${HADOLINT} Dockerfile
  - docker build -t jswny/dotfiles . && ${DIVE} jswny/dotfiles

deploy:
  - provider: script
    script: echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin && docker push "$DOCKER_IMAGE_NAME"
    on:
      branch: master

notifications:
  slack:
    secure: "GoeSycLMM8Wxhm01m7AjeBc2jacZ+/ZJtKov0F67BSnkF7DD6pLWThneB3M2LXg/ALd8aHX6RpIO+TEyB0ilB6+be82553qwuALBHleyQv7AEf8aCgbZXhdp7XIDYv0kGzweAGaBu0DWLJ0MdSJBLU9CYJziDfCD7+3QBDcvABWpoqytTbaa5s+YS6lOzci0bnB3FdktQi1zTHyL+k54WhuMz9PZhW7Bf/4BnDVjeWCFnwRzZQ4NnybCw2oIMEVxx0WXGsXx+h2p6gePan0UhgpJ6zNx1iHE861jZyNpFwl4WFlbxglQyJ0CrCa0pCxAxnMzfskOUvyXHaCOv/9mo8N7AO5/dsgEqKgsmnP+IFsuDD20VcM1dKTEI6nCa2JPWvrwqlLsHbCAOlg59SkRlb16Dn+y96H7SplsgeMggOwfna2zEN4vHpC86vOHh1fg7HRIdhrc4US3Brp4wpTZ5PEQURVYU0nPmt8kn+h68x8dLQcMyrkGVat2cnpk5G/tFei3JNG15c6fOWhFxzJpdqmiZh4tENFlUqUuHwI6K2ELnadHp8e4ljJ3TGSt+5/BNDuQYZucOB6pXF+feKcaXfqforYGpA8hKZ1eVyBwtRS0zfA+cIs4AwbbT5IMj3YFeM+Z+lqRgYhrKvYBARi8tfMjhKvrA6JYYm5kDykC6UY="
  email: false
